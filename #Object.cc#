#include "Object.h"

Object::~Object()
{
  SDL_FreeSurface(img);                 
}

void Object::Show(SDL_Surface* screen, float cameraX, float cameraY)
{
  SDL_Rect clip;

  switch(Animation)
    {
    case 0:
      CurrentFrame = 0;
      apply_surface(x + cameraX, y + cameraY, screen, &clip0);
      break;

    case 1:
      CurrentFrame++;
      if(CurrentFrame > Frames1)
	CurrentFrame = 0;

      apply_surface(x + cameraX, y + cameraY, screen, &clip1[CurrentFrame]);
      break;

    case 2:
      CurrentFrame++;
      if(CurrentFrame > Frames2)
	CurrentFrame = 0;

      apply_surface(x + cameraX, y + cameraY, screen, &clip2[CurrentFrame]);
      break;

    case 3:
      CurrentFrame++;
      if(CurrentFrame > Frames3)
	CurrentFrame = 0;

      apply_surface(x + cameraX, y + cameraY, screen, &clip3[CurrentFrame]);
      break;

    case 4:
      CurrentFrame++;
      if(CurrentFrame > Frames4)
	CurrentFrame = 0;

      apply_surface(x + cameraX, y + cameraY, screen, &clip4[CurrentFrame]);
      break;
    }

}


void Object::apply_surface(float x, float y, SDL_Surface* screen, SDL_Rect* clips = NULL)
{
  SDL_Rect offset;
    
      int x_ = int (x + 0.5);
      int y_ = int (y + 0.5);
    
      offset.x = x_;
      offset.y = y_;
    

    SDL_BlitSurface(img, clips, screen, &offset);
}


SDL_Surface *Object::load_image(std::string filename)
{
  SDL_Surface* loaded_image = NULL;

  SDL_Surface* optimized_image = NULL;

  loaded_image = IMG_Load(filename.c_str());

  if(loaded_image != NULL)
    {
      optimized_image = SDL_DisplayFormat(loaded_image);

      SDL_FreeSurface(loaded_image);
    }


  return optimized_image;
}

void Object::set_clips()
{
  clip0.x = 0;
  clip0.y = 0;
  clip0.w = int(Width + 0.5);
  clip0.h = int(Height + 0.5);

  for (int i = 0; i <= Frames1; i++)
    {
      clip1[i].x = i * int(Width + 0.5);
      clip1[i].y = int(Height + 0.5);
      clip1[i].w = int(Width);
      clip1[i].h = int(Height + 0.5);
    }

  for (int i = 0; i <= Frames2; i++)
    {
      clip2[i].x = i * int(Width + 0.5);
      clip2[i].y = int(Height + 0.5) * 2;
      clip2[i].w = int(Width);
      clip2[i].h = int(Height + 0.5);
    }

  for (int i = 0; i <= Frames3; i++)
    {
      clip3[i].x = i * int(Width + 0.5);
      clip3[i].y = int(Height + 0.5) * 3;
      clip3[i].w = int(Width);
      clip3[i].h = int(Height + 0.5);
    }

  for (int i = 0; i <= Frames4; i++)
    {
      clip4[i].x = i * int(Width + 0.5);
      clip4[i].y = int(Height + 0.5) * 4;
      clip4[i].w = int(Width);
      clip4[i].h = int(Height + 0.5);
    }
}